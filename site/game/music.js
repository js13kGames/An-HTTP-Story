import { delay } from "./utils";

// prettier-ignore
const songs = {
  404: [[[.5,0,220,,,2,1],[.8,0,2100,,,.2,3,3,,,-400,,,2],[.5,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[.5,0,440,,,2,1],[1.5,0,110,,,2,1,,,,,,,,,,,1.5]],[[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,]],[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,,36,,30,,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,36,,,,30,,]],[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,32,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,30,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,32,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,30,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,],[4,,13,,,,,,13,,20,,,,15,,,,13,,,,,,,,16,,,,18,,,,11,,,,,,11,,18,,,,15,,,,11,,,,,,,,,,,,,,,,]]],[0,1,2,2,3,3]],
  401: [[[.5,0,220,,,2,1,,,,,,,,,.1],[.8,0,2100,,,.2,3,3,,,-400,,,2],[.5,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[.5,0,440,,,.8,1,,,,,,,,,.1],[1.5,0,110,,,2,1,,,,,,,,,.1,,1.5]],[[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,]],[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,,36,,30,,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,36,,,,30,,]],[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,20,,,20,20,,,,20,,,,,,20,,18,,,18,18,,,,18,,,,,,18,,18,,,18,18,,,,18,,,,,,18,,16,,,16,16,,,,16,,,,,,,,,]],[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,20,,,20,20,,,,20,,,,,,20,,18,,,18,18,,,,18,,,,,,18,,18,,,18,18,,,,18,,,,,,18,,16,,,16,16,,,,16,,,,,,,,,],[4,,13,,,,8,,,,11,,8,,13,,,,,,,,,,11,,16,,,,18,,,,11,,,,,,11,,11,,,,6,,8,,11,,8,,13,,,,,,,,,,,,]]],[0,1,2,2,3,3]],
  403: [],
  500: []
};

let audio;
let volume;
export async function playMusic(name = "404", bpm = 100) {
  const song = songs[name];
  const songData = zzfxM(...song, bpm);

  await stopMusic();
  audio = zzfxP(...songData);
  audio.loop = true;

  // NOTE Volume control doesn't go to zero
  volume = audio.context.createGain();
  volume.gain.value = 1.0;
  audio.connect(volume);
  volume.connect(audio.context.destination);

  return audio;
}

export async function stopMusic() {
  if (audio) {
    volume.gain.linearRampToValueAtTime(0, audio.context.currentTime + 2);
    await delay(4000);
    audio.stop();
  }
}
