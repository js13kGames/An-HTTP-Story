import { delay } from "./utils";

// prettier-ignore
const songs = {
  404: [[[,0,220,,,2,1],[.5,0,2100,,,.2,3,3,,,-400,,,2],[.5,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[.5,0,440,,,2,1],[1.5,0,110,,,2,1]],[[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,]],[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,,36,,30,,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,36,,,,30,,]],[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,32,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,30,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,13,,,,16,,,,18,,,,20,,,,13,,,,16,,,,18,,,,20,,,,11,,,,15,,,,16,,,,18,,,,11,,,,15,,,,16,,,,18,,,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,32,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,30,,27,,28,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,],[4,,13,,,,,,13,,20,,,,15,,,,13,,,,,,,,16,,,,18,,,,11,,,,,,11,,18,,,,15,,,,11,,,,,,,,,,,,,,,,]]],[0,1,2,2,3,3]],
  401: [[[,0,220,,,2,1],[.5,0,2100,,,.2,3,3,,,-400,,,2],[.5,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[.5,0,440,,,1,1],[1.5,0,110,,,2,1]],[[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,]],[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,,36,,30,,,36,,36,,,,30,,36,,36,,,,30,,36,,,36,,30,,,36,,36,,,,30,,]],[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,20,,,20,20,,,,20,,,,,,20,,18,,,18,18,,,,18,,,,,,18,,18,,,18,18,,,,18,,,,,,18,,16,,,16,16,,,,16,,,,,,,,,]],[[,,13,,8,,16,,8,,18,,8,,20,,8,,13,,8,,16,,8,,18,,8,,20,,8,,11,,6,,15,,6,,16,,6,,18,,6,,11,,6,,15,,6,,16,,6,,18,,6,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,],[2,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,36,,36,,,,30,,],[3,,20,,,20,20,,,,20,,,,,,20,,18,,,18,18,,,,18,,,,,,18,,18,,,18,18,,,,18,,,,,,18,,16,,,16,16,,,,16,,,,,,,,,],[4,,13,,,,8,,,,11,,8,,13,,,,,,,,,,11,,16,,,,18,,,,11,,,,,,11,,11,,,,6,,8,,11,,8,,13,,,,,,,,,,,,]]],[0,1,2,2,3,3,2,3,3]],
  403: [[[.6,0,220,,,.5,2,,,,,,,,,.2,,,,1],[.5,0,2100,,,.2,3,3,,,-400,,,2],[.5,0,440,,,1,1],[1.5,0,110,,,2,1,,,,,,,,,.1]],[[[,,13,,13,,13,,13,,13,,13,,13,,13,,11,,11,,11,,11,,11,,11,,11,,11,,9,,9,,9,,9,,9,,9,,9,,9,,8,,8,,8,,8,,8,,8,,8,,8,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,]],[[,,13,,13,,13,,13,,13,,13,,13,,13,,11,,11,,11,,11,,11,,11,,11,,11,,9,,9,,9,,9,,9,,9,,9,,9,,8,,8,,8,,8,,8,,8,,8,,8,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,],[3,,25,,,,28,,25,,28,,25,,32,,,,,,,,,,,,,,,,,,,,25,,,,28,,25,,28,,25,,20,,,,,,,,,,,,,,,,,,,,]],[[,,13,,13,,13,,13,,13,,13,,13,,13,,11,,11,,11,,11,,11,,11,,11,,11,,9,,9,,9,,9,,9,,9,,9,,9,,8,,8,,8,,8,,8,,8,,8,,8,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,],[3,,25,,,,28,,25,,28,,25,,32,,,,,,,,,,,,,,,,,,,,25,,,,28,,25,,28,,25,,20,,,,,,,,,,,,,,,,,,,,],[2,,20,,,20,20,,,,20,,,,,,20,,18,,,18,18,,,,18,,,,,,18,,18,,,18,18,,,,18,,,,,,18,,21,,,21,21,,,,20,,,,,,,,,]],[[,,13,,13,,13,,13,,13,,13,,13,,13,,11,,11,,11,,11,,11,,11,,11,,11,,9,,9,,9,,9,,9,,9,,9,,9,,8,,8,,8,,8,,8,,8,,8,,8,,],[1,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,,,,,36,,,,,,,,36,,,,,,,,36,,,,36,,25,25,36,,,,],[3,,25,,,,28,,25,,28,,25,,32,,,,,,,,,,,,,,,,,,,,25,,,,28,,25,,28,,25,,20,,,,,,,,,,,,,,,,,,,,],[2,,20,,,20,20,,,,20,,,,,,20,,18,,,18,18,,,,18,,,,,,18,,18,,,18,18,,,,18,,,,,,18,,21,,,21,21,,,,20,,,,,,,,,],[2,,25,,,,25,,,,25,,,,25,,,,23,,,,23,,,,23,,,,23,,,,21,,,,21,,,,21,,,,21,,,,16,,,,16,,,,16,,,,16,,,,]]],[0,1,2,2,3,3,2,3,3]],
};

let currentlyPlaying;
let sourceNode;
export async function playMusic(name = "404", bpm = 100) {
  if (name === currentlyPlaying) return;
  currentlyPlaying = name;

  const song = songs[name];
  const songData = zzfxM(...song, bpm);

  await stopMusic();

  sourceNode = zzfxP(...songData);
  sourceNode.loop = true;
}

export async function stopMusic() {
  if (sourceNode) {
    // Setting the value seems to be required, even though the default value is 1
    sourceNode.volume.gain.setValueAtTime(1, zzfxX.currentTime);
    sourceNode.volume.gain.linearRampToValueAtTime(0, zzfxX.currentTime + 3);
    await delay(3000);
    sourceNode.stop();
  }
}
